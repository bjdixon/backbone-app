/*! backbone-app 23-02-2016 */
var app=app||{};app.Topic=Backbone.Model.extend({defaults:{title:"",subscribed:!1},toggle:function(){this.save({subscribed:!this.get("subscribed")})}});var app=app||{},TopicList=Backbone.Collection.extend({model:app.Topic,localStorage:new Backbone.LocalStorage("preferences-backbone"),subscribed:function(){return this.filter(function(a){return a.get("subscribed")})},notSubscribed:function(){return this.without.apply(this,this.subscribed())},nextOrder:function(){return this.length?this.last().get("order")+1:1},comparator:function(a){return a.get("order")}});app.Topics=new TopicList;var app=app||{};app.PreferencesView=Backbone.View.extend({tagName:"li",template:_.template($("#topic-template").html()),events:{"click .toggle":"toggle"},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){return this.$el.html(this.template(this.model.attributes)),this.$input=this.$(".toggle"),this.$input.prop("checked",this.model.get("subscribed")),this},toggle:function(){var a=this.$input.prop("checked");this.model.save({subscribed:a})}});var app=app||{};app.AppView=Backbone.View.extend({el:"#preferencesapp",statsTemplate:_.template($("#stats-template").html()),events:{"click #toggle-all":"toggleAllSubscribed"},initialize:function(){app.Topics.fetch(),app.Topics.length||(app.Topics.create({title:"Newsletter",subscribed:!0,order:app.Topics.nextOrder()}),app.Topics.create({title:"Offers",subscribed:!1,order:app.Topics.nextOrder()}),app.Topics.create({title:"Service Alerts",subscribed:!0,order:app.Topics.nextOrder()}),app.Topics.create({title:"Invoices",subscribed:!0,order:app.Topics.nextOrder()})),this.allCheckbox=this.$("#toggle-all")[0],this.$footer=this.$("#footer"),this.$main=this.$("#main"),this.listenTo(app.Topics,"all",this.render),app.Topics.fetch()},render:function(){var a=app.Topics.subscribed().length,b=app.Topics.notSubscribed().length;app.Topics.length?(this.$main.show(),this.$footer.show(),this.$footer.html(this.statsTemplate({subscribed:a,numberOfTopics:a+b}))):(this.$main.hide(),this.$footer.hide()),this.addAll(),this.allCheckbox.checked=!b},addOne:function(a){var b=new app.PreferencesView({model:a});$("#preferences-list").append(b.render().el)},addAll:function(){this.$("#preferences-list").html(""),app.Topics.each(this.addOne,this)},toggleAllSubscribed:function(){var a=this.allCheckbox.checked;app.Topics.each(function(b){b.save({subscribed:a})})}});var app=app||{};$(function(){new app.AppView});